<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="English, Korean">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-center-atom.min.css?v=1.0.2">























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="안녕하세요. 요즘 취업 시즌이 한창이다보니, 블로그에 글쓰는게 또 게을러지게 되었네요. ㅜㅜ  오늘은 지난 포스트에 이어서, 프로그래밍 코드를 이용한 MQTT 메시지 교환 - 안드로이드 편을 포스트하고자 합니다. 혹시 아직 MQTT에 대한 개념이나, Broker를 설치하지 않으신 분들은 아래 링크를 통해, 이전 글을 반드시 구독해주신 후, 이 포스트를 참조">
<meta name="keywords" content="android,Kotlin,MQTT">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 에서 MQTT를 사용하는 방법">
<meta property="og:url" content="http://devlab.neonkid.xyz/2017/10/01/android/2017-10-01-Android-에서-MQTT-를-사용해보자/index.html">
<meta property="og:site_name" content="N.K Dev Lab">
<meta property="og:description" content="안녕하세요. 요즘 취업 시즌이 한창이다보니, 블로그에 글쓰는게 또 게을러지게 되었네요. ㅜㅜ  오늘은 지난 포스트에 이어서, 프로그래밍 코드를 이용한 MQTT 메시지 교환 - 안드로이드 편을 포스트하고자 합니다. 혹시 아직 MQTT에 대한 개념이나, Broker를 설치하지 않으신 분들은 아래 링크를 통해, 이전 글을 반드시 구독해주신 후, 이 포스트를 참조">
<meta property="og:locale" content="English, Korean">
<meta property="og:image" content="http://devlab.neonkid.xyz/media/images/android/MQTT-1.gif">
<meta property="og:image" content="http://devlab.neonkid.xyz/media/images/android/MQTT-2.png">
<meta property="og:updated_time" content="2020-03-20T12:26:27.187Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android 에서 MQTT를 사용하는 방법">
<meta name="twitter:description" content="안녕하세요. 요즘 취업 시즌이 한창이다보니, 블로그에 글쓰는게 또 게을러지게 되었네요. ㅜㅜ  오늘은 지난 포스트에 이어서, 프로그래밍 코드를 이용한 MQTT 메시지 교환 - 안드로이드 편을 포스트하고자 합니다. 혹시 아직 MQTT에 대한 개념이나, Broker를 설치하지 않으신 분들은 아래 링크를 통해, 이전 글을 반드시 구독해주신 후, 이 포스트를 참조">
<meta name="twitter:image" content="http://devlab.neonkid.xyz/media/images/android/MQTT-1.gif">






  <link rel="canonical" href="http://devlab.neonkid.xyz/2017/10/01/android/2017-10-01-Android-에서-MQTT-를-사용해보자/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Android 에서 MQTT를 사용하는 방법 | N.K Dev Lab</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="English, Korean">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">N.K Dev Lab</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags<span class="badge">21</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories<span class="badge">9</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-timeline">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Timeline</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/NEONKID" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://devlab.neonkid.xyz/2017/10/01/android/2017-10-01-Android-에서-MQTT-를-사용해보자/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kwang Soo Jeong">
      <meta itemprop="description" content="Junior Data Engineer">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="N.K Dev Lab">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android 에서 MQTT를 사용하는 방법

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-10-01 04:27:19" itemprop="dateCreated datePublished" datetime="2017-10-01T04:27:19+00:00">2017-10-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-03-20 12:26:27" itemprop="dateModified" datetime="2020-03-20T12:26:27+00:00">2020-03-20</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>안녕하세요. 요즘 취업 시즌이 한창이다보니, 블로그에 글쓰는게 또 게을러지게 되었네요. ㅜㅜ </p>
<p>오늘은 지난 포스트에 이어서, 프로그래밍 코드를 이용한 MQTT 메시지 교환 - 안드로이드 편을 포스트하고자 합니다.</p>
<p>혹시 아직 MQTT에 대한 개념이나, Broker를 설치하지 않으신 분들은 아래 링크를 통해, 이전 글을 반드시 구독해주신 후, 이 포스트를 참조하시기 바랍니다.</p>
<div markdown="0"><a href="http://blog.neonkid.xyz/127" class="button" target="_blank" rel="noopener">MQTT 프로토콜 개념과 이해</a></div>

<p><br></p>
<h2 id="Eclipse-Paho"><a href="#Eclipse-Paho" class="headerlink" title="Eclipse Paho"></a>Eclipse Paho</h2><p>MQTT 프로토콜을 사용해 메시지 교환을 하기 위해서는 MQTT 통신이 가능한 라이브러리가 필요합니다. 그 중에서도 저희는 Java와 아주 궁합이 좋은 Eclipse Paho를 사용하고자 합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &apos;org.eclipse.paho:org.eclipse.paho.client.mqttv3:1.1.1&apos;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;org.eclipse.paho:org.eclipse.paho.client.mqttv3:1.1.1&apos;</span><br></pre></td></tr></table></figure>
<p>Gradle 3.0 버전을 사용하신다면, implementation을, Gradle 2.x 버전을 사용하신다면, compile 코드를 build.gradle에 삽입합니다. </p>
<p><br></p>
<h2 id="Using-Paho"><a href="#Using-Paho" class="headerlink" title="Using Paho"></a>Using Paho</h2><p>자 이제 그럼 Paho를 사용해서 MQTT를 사용해보도록 하겠습니다. MQTT가 기본적으로 하는 일에는 Publish, Subscribe가 있는데요. 그 전에 우리는 MQTT Broker와 연결해줘야 합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> client = MqttClient(ip_addr, clientID, MemoryPersistece())</span><br><span class="line">client.connect()</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MqttClient client = <span class="keyword">new</span> MqttClient(ip_addr, clientID, <span class="keyword">new</span> MemoryPersistence());</span><br><span class="line">client.connect();</span><br></pre></td></tr></table></figure>
<p>MqttClient 라는 객체를 생성하여, 생성자에 브로커의 IP 주소와 해당 브로커에서 사용할 ID 그리고 채팅 내용이 들어갈 여유의 MemoryPersistence 객체를 MqttClient 생성자에게 넘겨줍니다.</p>
<p>마지막으로 connect 메소드를 사용하여 연결을 시도합니다.</p>
<p>위 형태가 기본형입니다. 통신 서비스이기 때문에 연결이 실패할 경우도 있을 수 있으므로, 반드시 예외 처리를 해주도록 합시다. 연결이 끝나면, disconnect 메소드를 이용해 연결을 끊으시면 됩니다.</p>
<p><br></p>
<h3 id="Publish"><a href="#Publish" class="headerlink" title="Publish"></a>Publish</h3><p>이제 연결을 하였으니, 메시지를 보내보도록 하겠습니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  client.connect()</span><br><span class="line">  client.publish(topic, MqttMessage(<span class="string">"Hello MQTT !"</span>.toByteArray()))</span><br><span class="line">&#125; <span class="keyword">catch</span> (ex: MqttException) &#123;</span><br><span class="line">  ex.printStackTrace()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  client.connect();</span><br><span class="line">  client.publish(topic, <span class="keyword">new</span> MqttMessage(<span class="keyword">new</span> String(<span class="string">"Hello MQTT !"</span>).getBytes()));</span><br><span class="line">&#125; <span class="keyword">catch</span> (MqttException ex) &#123;</span><br><span class="line">  ex.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Message를 보내는 것도 어렵지 않습니다. 연결을 할 떄, 반드시 위와 같이 오류 처리를 해주시면 됩니다. 다만 publish를 할 때 보낼 메시지는 String이 아닌 ByteArray 형태로 전송되어야 합니다. 이 부분은 Java/Kotlin 언어에서 지원하는 String 객체의 메소드를 사용하여 쉽게 변환할 수 있습니다.</p>
<p><br></p>
<h3 id="Subscribe"><a href="#Subscribe" class="headerlink" title="Subscribe"></a>Subscribe</h3><p>메시지를 발행하는 방법을 알았으니 다음은 이제 메시지를 구독하는 방법을 알아보겠습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  client.connect()</span><br><span class="line">  client.subscribeWithResponse(topic, <span class="number">2</span>, IMqttMessageListener)</span><br><span class="line">&#125; <span class="keyword">catch</span> (ex: MqttException) &#123;</span><br><span class="line">  ex.printStrackTrace()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  client.connect();</span><br><span class="line">  client.subscribeWithResponse(topic, <span class="number">2</span>, <span class="keyword">new</span> IMqttMessageListener);</span><br><span class="line">&#125; <span class="keyword">catch</span> (MqttException ex) &#123;</span><br><span class="line">  ex.printStaceTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>메시지를 구독을 할 떄는 단순히 메소드 호출로만 이루어지기 힘들겠죠? 단순 subscribe 메소드도 있긴 하지만, 이는 진짜 메시지를 구독만 할 것일 뿐 이를 프로그램에서 소화하려면 콜백 함수 인터페이스를 사용해야 합니다. 그래서, IMqttMessageListener를 사용합니다.</p>
<p>코틀린 언어에서는 다음과 같은 코드로도 사용하실 수 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  client.connect()</span><br><span class="line">  client.subscribeWithResponse(topic, <span class="number">2</span>, &#123; topic, message -&gt; ... &#125;)</span><br><span class="line">&#125; <span class="keyword">catch</span> (ex: MqttException) &#123;</span><br><span class="line">  ex.printStrackTrace()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Lambda 방법이 생소하신 분들을 위해 조금 설명을 드리자면, 매우 쉽습니다. No-Lambda에서는 함수 이름을 붙여야 했지만, Lambda 방법을 사용하면 메소드의 인자값을 주고, 화살표만 넣어주신 다음 메소드의 액션을 넣으시면 됩니다. 얼핏보면 Java 8 에서 지원하는 Lambda 사용법이랑 비슷합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">messageArrived</span><span class="params">(topic: <span class="type">String</span>?, message: <span class="type">MqttMessage</span>?)</span></span> &#123;</span><br><span class="line">  <span class="comment">// Todo: 여기에서 메시지를 처리합니다. 메시지는 MqttMessage 객체로 받습니다.</span></span><br><span class="line">  Log.i(topic + <span class="string">": "</span>, String(message!!.payload))	<span class="comment">// String 값으로 받으려면 이렇게....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">messageArrived</span><span class="params">(String topic, MqttMessage message)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Todo: 여기에서 메시지를 처리합니다. 메시지는 MqttMessage 객체로 받습니다.</span></span><br><span class="line">  Log.i(topic + <span class="string">": "</span>, <span class="keyword">new</span> String(message.getPayload()));	<span class="comment">// Java 에서...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>콜백 함수에 들어있는 인자 값을 이용해 String 생성자를 이용하여 간단히 String 형태로 바꾸어 사용하실 수 있습니다</p>
<p>그리고, 가운데 인자인 2는 QoS를 의미합니다. MQTT의 QoS는 다음과 같습니다.</p>
<ul>
<li>QoS = 0 : 수신 측 확인 없이 1회 전송합니다.</li>
<li>QoS = 1 : 수신 측의 ACK를 확인하고 ACK가 오지 않으면 재전송합니다. (여가서 재전송할 때, 수신측에서는 중복 메시지를 받을 수 없습니다)</li>
<li>QoS = 2 : 송신/수신 측 모두 ACK 를 확인합니다</li>
</ul>
<p>QoS는 여러분이 원하시는 번호로 하시면 됩니다. 사실 테스트 전송에는 많은 영향을 받지 않습니다. 실제 QoS 동작을 확인해보시려면 직접 패킷 캡처링을 해보시기 바랍니다.</p>
<p><br></p>
<h2 id="Android-Kotlin-Example"><a href="#Android-Kotlin-Example" class="headerlink" title="Android / Kotlin Example"></a>Android / Kotlin Example</h2><p>그럼 이제 안드로이드 앱으로 만들어보도록 하겠습니다. 중간에 Broker를 놓고, 클라이언트 두개가 서로 메시지를 주고 받는 것에 대해 간단한 예제를 담아봤습니다.</p>
<p>이 예제 프로그램은 안드로이드 앱에서 특정 메시지를 전송하면, 더 이상 그들 둘 사이의 메시지 교환이 이루어지지 않는 프로그램으로 메시지를 통한 인증 프로그램과 유사한 앱을 만들어봤습니다.</p>
<p><img src="/media/images/android/MQTT-1.gif" alt="MQTT-1"></p>
<p>겉보기에는 MQTT를 이용해 통신하고 있다는 모습처럽 보이지는 않죠? 포스트를 하면서 여러모로 많은 고민을 해봤지만 가장 간단한 예제로 접할 수 있는 것이 이것밖에 생각나지 않았습니다.. ㅠㅠ</p>
<p><img src="/media/images/android/MQTT-2.png" alt="MQTT-2"></p>
<p>간단히 다이어그램으로 알아보자면, 위와 같습니다. 서버에서도 동일한 MQTT 통신 코드를 가지고 있습니다. 해당 서버에서 메시지를 받았을 때, 올바른 키가 전송되었으면 그에 해당하는 응답을 주고, 그렇지 않으면 실패 코드를 안드로이드 앱에게 부여합니다. </p>
<p>코드를 통해 살펴보도록 하겠습니다.</p>
<p><br></p>
<h3 id="Server-Code"><a href="#Server-Code" class="headerlink" title="Server Code"></a>Server Code</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">client.subscribeWithResponse(<span class="string">"mqttKotlin_send"</span>, <span class="number">2</span>, &#123; topic, message -&gt;</span><br><span class="line">  <span class="comment">// Java 의 Switch - case 문..</span></span><br><span class="line">  <span class="keyword">when</span>(String(message.payload).trim()) &#123;</span><br><span class="line">    <span class="string">"IMNKID"</span> -&gt; &#123;</span><br><span class="line">      client.publish(<span class="string">"mqttKotlin_recv"</span>, MqttMessage(<span class="string">"Congratulations Key !!!"</span>.toByteArray()))</span><br><span class="line">      client.disconnect()</span><br><span class="line">      exitProcess(<span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">      println(String(message.payload))</span><br><span class="line">      client.publish(<span class="string">"mqttKotlin_recv"</span>, MqttMessage(<span class="string">"FAILED....."</span>.toByteArray()))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>서버 코드는 간단합니다. 올바른 키를 받았을 떄의 상황을 Switch - case 문을 사용하였고, 서로가 주고 받는 메시지의 Topic을 다르게 주었습니다. 이 부분은 다르게 주는 것을 권장합니다. 메시지가 섞이는 경우, 통계나 관리가 힘들어지게 됩니다.</p>
<p><br></p>
<h3 id="Client-Code"><a href="#Client-Code" class="headerlink" title="Client Code"></a>Client Code</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">      client.subscribeWithResponse(topic_recv, <span class="number">2</span>, &#123; topic, msg -&gt;</span><br><span class="line">        Log.i(<span class="string">"[RECV]"</span>, String(msg.payload))</span><br><span class="line">        <span class="keyword">when</span>(String(msg.payload).contains(<span class="string">"Congratulations"</span>)) &#123;</span><br><span class="line">          <span class="literal">true</span> -&gt; &#123;</span><br><span class="line">            runOnUiThread(&#123;</span><br><span class="line">              action_image.setImageDrawable(getDrawable(<span class="string">"DRAWABLE_SRC"</span>))</span><br><span class="line">              message.setHint(<span class="string">"Congratulations, This is correct key ! "</span>)</span><br><span class="line">              setToastMessage(<span class="string">"Wow............."</span>)</span><br><span class="line">              sendBtn.isEnabled = <span class="literal">false</span></span><br><span class="line">            &#125;)</span><br><span class="line">            client.disconnect()</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="literal">false</span> -&gt; setToastMessage(<span class="string">"Cheer up ! Please Try again......"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ex: MqttException) &#123;</span><br><span class="line">      setToastMessage(ex.message)</span><br><span class="line">      ex.printStackTrace()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>맨 처음 Activity가 만들어지는 부분에 Broker 연결과 Subscribe 를 추가해줍니다. Subscribe를 Activity가 생성되는 부분에 추가하여 메시지가 구독될 경우, 콜백/쓰레드를 통해 실시간으로 받을 수 있도록 합니다.</p>
<p>(어? 여기서 Thread 따로 생성안했는데? 아, MQTT 라이브러리는 별도로 Thread 객체를 사용안하셔도 됩니다…)</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sendBtn.setOnClickListener(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onClick</span><span class="params">(p0: <span class="type">View</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      client.publish(topic_send, MqttMessage(message.text.toString().toByteArray()))</span><br><span class="line">      message.setText(<span class="string">""</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ex: MqttException) &#123;</span><br><span class="line">      setToastMessage(ex.message)</span><br><span class="line">      ex.printStrackTrace()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">setToastMessage</span><span class="params">(msg: <span class="type">String</span>?)</span></span> &#123;</span><br><span class="line">    runOnUiThread(&#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, msg, Toast.LENGTH_SHORT).show()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>키를 서버에게 주는 방법 또한 위에서 얘기한 Publish의 간단한 예제를 조금만 응용하면 됩니다. </p>
<p><br></p>
<h2 id="마치며…"><a href="#마치며…" class="headerlink" title="마치며…."></a>마치며….</h2><p>여기까지 Java, Kotlin 언어를 사용하여 간단한 MQTT 앱을 만들어보는 것과 예제를 다뤄봤습니다.</p>
<p>저도 처음 다뤄보는 Kotlin이라 그런지 많이 헷갈립니다. ㅋㅋ.. Kotlin 에 대해 짧게나마 얘기 드리자면, 수다를 엄청 좋아하는 Java에 비하면 정말 10배는 좋은 것 같습니다. 코드의 줄 수도 많이 줄고, 그만큼 독해(?) 하는 데 있어서 많이 완화된 모습을 보여줍니다.</p>
<p>다만 지금 Kotlin이 안드로이드 공식 언어가 되었다고 하여, 무작정 Kotlin으로 나가는 것은 개인적으로 추천드리진 않습니다. Java를 확실하게 익혀두신 후, Kotlin에 접해보시기 바랍니다.</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/android/" rel="tag"># android</a>
          
            <a href="/tags/Kotlin/" rel="tag"># Kotlin</a>
          
            <a href="/tags/MQTT/" rel="tag"># MQTT</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/01/android/2017-08-01-Android-Custom-View-를-만들어보자/" rel="next" title="Android CustomView를 만들어보자">
                <i class="fa fa-chevron-left"></i> Android CustomView를 만들어보자
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/10/28/c++/2017-10-27-C++-언어에서-MQTT-사용해보기/" rel="prev" title="C++ 언어에서 MQTT 사용해보기">
                C++ 언어에서 MQTT 사용해보기 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="gitalk-container">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Kwang Soo Jeong</p>
              <p class="site-description motion-element" itemprop="description">Junior Data Engineer</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/NEONKID" title="GitHub &rarr; https://github.com/NEONKID" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:contact@neonkid.xyz" title="E-Mail &rarr; mailto:contact@neonkid.xyz" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://twitter.com/clax1412" title="Twitter &rarr; https://twitter.com/clax1412" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.facebook.com/NK.4869" title="Facebook &rarr; https://www.facebook.com/NK.4869" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i>Facebook</a>
                </span>
              
            </div>
          

          
             <div class="cc-license motion-element" itemprop="license">
              
                
              
              
              
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
             </div>
          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Eclipse-Paho"><span class="nav-number">1.</span> <span class="nav-text">Eclipse Paho</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Using-Paho"><span class="nav-number">2.</span> <span class="nav-text">Using Paho</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Publish"><span class="nav-number">2.1.</span> <span class="nav-text">Publish</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Subscribe"><span class="nav-number">2.2.</span> <span class="nav-text">Subscribe</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Android-Kotlin-Example"><span class="nav-number">3.</span> <span class="nav-text">Android / Kotlin Example</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Server-Code"><span class="nav-number">3.1.</span> <span class="nav-text">Server Code</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Client-Code"><span class="nav-number">3.2.</span> <span class="nav-text">Client Code</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#마치며…"><span class="nav-number">4.</span> <span class="nav-text">마치며….</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Neon K.I.D</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.0.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  



  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/reading_progress/reading_progress.js"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.0"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  


  
    

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">



<script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script>

<script>
  var gitalk = new Gitalk({
    clientID: 'deff617b90416ac3ab91',
    clientSecret: '252a116f6555abbf6720cb0701491d2d9cf75038',
    repo: 'neonkid.github.io',
    owner: 'neonkid',
    admin: ['neonkid'],
    id: md5(location.pathname),
    distractionFreeMode: 'true'
  });
  gitalk.render('gitalk-container');
</script>

  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
